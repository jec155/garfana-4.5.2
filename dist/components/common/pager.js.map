{"version":3,"sources":["../../../src/components/common/pager.js"],"names":["pageDirective","restrict","templateUrl","link","scope","iElement","iAttrs","controller","myPage","numberOfPages","totalItems","jumpPageNum","pageParams","currentPage","itemsPerPage","changeCurrentPage","p","getPagination","URL","prevPage","nextPage","jumpToPage","showError","changeItemsPerPage","url","http","get","params","then","response","names","data","parseInt","Math","ceil","pageList","i","pagesLength","push","offset"],"mappings":"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","file":"pager.js","sourcesContent":["import './pager.css!';\r\n\r\nconst pagesLength=9;\r\n\r\nexport function pageDirective() {\r\n    return {\r\n        restrict: 'E',\r\n        templateUrl: 'public/plugins/grafana-management/components/common/pager.html',\r\n        link:function (scope, iElement, iAttrs, controller) {\r\n            scope.myPage={};\r\n            scope.myPage.numberOfPages=0;\r\n            scope.myPage.totalItems=0;\r\n            scope.myPage.jumpPageNum=1;\r\n\r\n            scope.pageParams.currentPage=1;\r\n            scope.pageParams.itemsPerPage=10;\r\n\r\n            scope.changeCurrentPage = function(p){\r\n                if(p == '...'){\r\n                    return;\r\n                }else{\r\n                    scope.pageParams.currentPage = p;\r\n                }\r\n                getPagination(scope.URL);\r\n            };\r\n            scope.prevPage = function(){\r\n                if(scope.pageParams.currentPage > 1){\r\n                    scope.pageParams.currentPage -= 1;\r\n                }else {\r\n                    scope.pageParams.currentPage=1;\r\n                }\r\n                getPagination(scope.URL);\r\n            };\r\n            // nextPage\r\n            scope.nextPage = function(){\r\n                if(scope.pageParams.currentPage < scope.myPage.numberOfPages){\r\n                    scope.pageParams.currentPage += 1;\r\n                }else {\r\n                    scope.pageParams.currentPage=scope.myPage.numberOfPages;\r\n                }\r\n                getPagination(scope.URL)\r\n            };\r\n\r\n            // 跳转页\r\n            scope.jumpToPage = function(){\r\n                if(scope.myPage.jumpPageNum>0 || scope.myPage.jumpPageNum<=scope.myPage.numberOfPages){\r\n                    scope.pageParams.currentPage=scope.myPage.jumpPageNum;\r\n                    getPagination(scope.URL);\r\n                }else {\r\n                    scope.myPage.showError=true;\r\n                }\r\n            };\r\n            // 修改每页显示的条数\r\n            scope.changeItemsPerPage = function(){\r\n                getPagination(scope.URL);\r\n            };\r\n            getPagination(scope.URL);\r\n\r\n            function getPagination(url){\r\n                //console.info(url);\r\n                //console.info(scope.pageParams);\r\n                scope.http.get(url\r\n                    ,{params:scope.pageParams}).then(\r\n                    function (response)\r\n                    {\r\n                        scope.names=response.data.data;\r\n                        scope.myPage.totalItems=response.data.totalItems;//当获取总数据后，修改默认值\r\n                        scope.myPage.totalItems = parseInt(scope.myPage.totalItems);\r\n                        // numberOfPages,总共分多少页\r\n                        scope.myPage.numberOfPages = Math.ceil(scope.myPage.totalItems/scope.pageParams.itemsPerPage);\r\n                        if(scope.pageParams.currentPage < 1){\r\n                            scope.pageParams.currentPage = 1;\r\n                        }\r\n\r\n                        if(scope.pageParams.currentPage > scope.myPage.numberOfPages){\r\n                            scope.pageParams.currentPage = scope.myPage.numberOfPages;\r\n                        }\r\n\r\n                        scope.pageList = [];\r\n                        var i;\r\n                        if(scope.myPage.numberOfPages <= pagesLength){\r\n                            // 判断总页数如果小于等于分页的长度，若小于则直接显示\r\n                            for(i =1; i <= scope.myPage.numberOfPages; i++){\r\n                                scope.pageList.push(i);\r\n                            }\r\n                        }else{\r\n                            // 总页数大于分页长度（此时分为三种情况：1.左边没有...2.右边没有...3.左右都有...）\r\n                            // 计算中心偏移量\r\n                            var offset = (pagesLength - 1)/2;\r\n                            if(scope.pageParams.currentPage <= offset){\r\n                                // 左边没有...\r\n                                for(i =1; i <= offset +1; i++){\r\n                                    scope.pageList.push(i);\r\n                                }\r\n                                scope.pageList.push('...');\r\n                                scope.pageList.push(scope.myPage.numberOfPages);\r\n                                //    >实际总页数-每页的一半\r\n                            }else if(scope.pageParams.currentPage > scope.myPage.numberOfPages - offset){\r\n                                scope.pageList.push(1);\r\n                                scope.pageList.push('...');\r\n                                for(i = offset + 1; i >= 1; i--){\r\n                                    scope.pageList.push(scope.myPage.numberOfPages - i);\r\n                                }\r\n                                scope.pageList.push(scope.myPage.numberOfPages);\r\n                            }else{\r\n                                // 最后一种情况，两边都有...\r\n                                scope.pageList.push(1);\r\n                                scope.pageList.push('...');\r\n\r\n                                for(i = Math.ceil(offset/2) ; i >= 1; i--){\r\n                                    scope.pageList.push(scope.pageParams.currentPage - i);\r\n                                }\r\n                                scope.pageList.push(scope.pageParams.currentPage);\r\n                                for(i = 1; i <= offset/2; i++){\r\n                                    scope.pageList.push(scope.pageParams.currentPage + i);\r\n                                }\r\n\r\n                                scope.pageList.push('...');\r\n                                scope.pageList.push(scope.myPage.numberOfPages);\r\n                            }\r\n                        }\r\n                    }\r\n                )\r\n            }\r\n        },\r\n        scope: false\r\n    };\r\n}"]}